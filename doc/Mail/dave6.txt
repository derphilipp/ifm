From dchapes@ddm.on.ca Thu Sep 03 07:43:41 1998
Received: from punt-21.mail.demon.net by hunting2.demon.co.uk with SMTP 
	id AA904833821 ; Thu, 03 Sep 98 07:43:41 PDT
Received: from punt-2.mail.demon.net by mailstore for zondo@hunting2.demon.co.uk
          id 904791385:20:21755:1; Thu, 03 Sep 98 02:56:25 GMT
Received: from p36.radon.sentex.ca ([207.245.238.101]) by punt-2.mail.demon.net
           id aa2021639; 3 Sep 98 2:56 GMT
Received: from squigy.ddm.on.ca (squigy.ddm.on.ca [209.112.59.10])
	by ymris.ddm.on.ca (8.8.8/8.8.8) with ESMTP id WAA02084
	for <zondo@hunting2.demon.co.uk>; Wed, 2 Sep 1998 22:56:04 -0400 (EDT)
	(envelope-from dchapes@ymris.ddm.on.ca)
Received: (from dchapes@localhost)
	by squigy.ddm.on.ca (8.8.8/8.8.7) id WAA01466;
	Wed, 2 Sep 1998 22:56:02 -0400 (EDT)
Message-ID: <19980902225602.46285@ddm.on.ca>
Date: Wed, 2 Sep 1998 22:56:02 -0400
From: Dave Chapeskie <dchapes@ddm.on.ca>
To: zondo@hunting2.demon.co.uk
Subject: Re: Ifm v2.0
References: <116@hunting2.demon.co.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.89i
In-Reply-To: <116@hunting2.demon.co.uk>; from Glenn Hutchings on Thu, Aug 13, 1998 at 05:29:22PM +0000
Return-Receipt-To: dchapes@ddm.on.ca
X-Mutt-References: <116@hunting2.demon.co.uk>
Status: R

Sorry I took so long to get to this...

I found the packaging to be much better than for v1.0!  Autoconf really
helps.  I did find a couple of small problems though.

In lib/vars-regexp.c you should include "vars-def.h" BEFORE <regex.h>.
The reason is that some systems already have a GNU-like regex
library that defines RE_DUP_MAX.  On FreeBSD this gets defined in
/usr/include/regex.h (which doesn't conflict with your regex.h due to
a "-I." option) which is pulled in from /usr/include/limits.h witch
gets pulled in by vars-def.h.  Your regex.h expects this to happen and
undefines the constant first but only if it's parsed AFTER.

FreeBSD has a value of 255 for this whereas your regex.h uses 65355 so
this may cause problems if the warning is ignored (I didn't actually try
running it that way, I fixed it right away).

This seems to stem from your libraries being slightly modified versions
of ones FreeBSD already has.  In IFM1.0 I actually disabled the
compilation of most of your library and used the FreeBSD versions
instead.

The other problem was that on FreeBSD tcl/tk are installed with the
version numbers in the executable name.  This is to get around all
the versionitis with tcl/tk and the FreeBSD ports.  I had to change
your configure script to look for "wish8.0" instead of "wish".  There
should be a generic way of finding this out on all platforms (perhaps a
--with-wish=NAME option to configure...) but I didn't bother trying to
find a generic solution.


Anyway, on to more important matters.

IFM wasn't honouring the "tk" lines in my ~/.ifmrc file.  In debugging
this I focused on "show_items" since that's what first caught my
attention.  My .ifmrc file has (among other things):

    show_items=1;
    tk show_items=0;
(This made more sense when there were more than just "ps" and "tk"
formats but anyway...)

Then running:
    % ifm -m -f tk /dev/null | egrep showitems
    set ifm(showitems) 1

Clearly wrong.  Removing the word "tk" from the second line shown above
'fixed' the problem.  So I tried:

    % env V_DBG_HASHREFS= ifm -m -f tk /dev/null |& egrep show_items
    Vars warning: access of non-existent hash entry: default map 0 show_items

Noticing the word "default" where I expected "tk", I hunted down where
the format gets set (ctags are a wonderful thing...) and I found that
things _appear_ to work with the following small change:

--- src/ifm-main.c.orig	Wed Aug 12 08:42:01 1998
+++ src/ifm-main.c	Wed Aug 26 20:13:48 1998
@@ -271,8 +271,8 @@
     if (output != O_NONE && ifm_fmt < 0) {
         vscalar *var = get_var("format");
         ifm_fmt = select_format(var != NULL ? vs_sget(var) : NULL, output);
-        ifm_format = drivers[ifm_fmt].name;
     }
+    ifm_format = drivers[ifm_fmt].name;
 
     /* Resolve tags */
     resolve_tags();

It's up to you to determine if that's the correct fix or if that will
break something else :-)   I didn't spend too much time on it and it
works for how I normally use IFM.


Another minor problem I noticed, check out
www.sentex.net/~dchapes/ifm/Ralph.ifm

Notice that the walkthrough goes E, E, SW, E instead of E, SE.  Ifm
1.0 used to say "Ruined Shed (2 rooms away):"  Similarly going from
the Tree to the south lawn is down with SE, W, SE, W instead of S, S
(although here ifm 1.0 said 3 rooms away instead of 2).

There seems to be a couple of tiny bugs like the above.  In particular I
ran into problems trying to get a half decent task list for Zork I.  I
finally gave up on it for now.


Wish list:

- When the map file is re-read or the "Redraw" menu item select try and
  keep the map windows up at there current locations instead of closing
  them all.

- In ~/.tkifmrc allow specification of locations for the edit, list,
  and task windows.

- other things I can't think of at the moment...

Overall I'm quite impressed with the improvements over v1.0, great job!
Oh, and thanks for the mention in the README files :-)
-- 
Dave Chapeskie <dchapes@ddm.on.ca>, DDM Consulting

